import serial
import time

# Define the Modbus slave ID and register addresses for flowrate and pH
SLAVE_ID = 1
FLOWRATE_ADDRESS = 0
PH_ADDRESS = 1

# Define the Modbus RTU port and baudrate
PORT = "/dev/ttyUSB0"
BAUDRATE = 9600

# Open the Modbus RTU serial port
ser = serial.Serial(port=PORT, baudrate=BAUDRATE, bytesize=8, parity='N', stopbits=1, xonxoff=0)
ser.timeout = 1

# Simulate continuous Modbus data for flowrate and pH
while True:
    # Simulate flowrate and pH data
    flowrate = 50.0 + 50.0 * (time.time() % 10) / 10.0  # Range from 50 to 100
    ph = 6.0 + 1.0 * (time.time() % 10) / 10.0  # Range from 6 to 7
    
    # Convert the flowrate and pH data to Modbus register values
    flowrate_value = int(flowrate * 10)
    ph_value = int(ph * 10)
    
    # Build the Modbus RTU frame for flowrate and pH data
    frame = bytearray([SLAVE_ID, 6, 0, FLOWRATE_ADDRESS, (flowrate_value >> 8) & 0xff, flowrate_value & 0xff])
    ser.write(frame)
    time.sleep(0.01)
    frame = bytearray([SLAVE_ID, 6, 0, PH_ADDRESS, (ph_value >> 8) & 0xff, ph_value & 0xff])
    ser.write(frame)
    time.sleep(0.01)
